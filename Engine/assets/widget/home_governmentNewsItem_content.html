<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="css/ui-box.css">
        <link rel="stylesheet" href="css/ui-base.css">
        <link rel="stylesheet" href="css/ui-color.css">
        <link rel="stylesheet" href="css/appcan.control.css">
        <link rel="stylesheet" href="css/ui-color.css">
        <link rel="stylesheet" href="css/new_file.css">
        <link rel="stylesheet" href="css/common.css">
        <link rel="stylesheet" href="css/loader.css">
    </head>
    <body class="um-vp bg-fa f-f" ontouchstart>
        <div id="page_0" class="up ub ub-ver bc-bg" tabindex="0">
       <!--header开始-->
            <div id="header" class="bc-text-head ub ub-ver" style="background-color:#F3F3F3;">
                <div class="ub uinn" style="background-color: #F3F3F3;">
                    <div class="uinput ub ub-f1 uba ub-ac" style="background-color: #FFFFFF;border-radius:0.8em;margin-right:0.85em;">
                        <div class="ub ub-img ub-ac ub-pc" style="background-image: url('image/shous02.png'); width: 1.5em; height:1.3em;"></div>
                        <input placeholder="政府" id="keyVal" type="text" class="ub-f1">
                        <div class="ub-img ub-ac ub-pc ocancle" id="clean"></div> 
                    </div>
                    <div class="ub ub-ac ub-pc" id="doSearch" style="padding: .2em .5em;color: #fff;background-color:#FF8A00;border-radius:0.6em;">搜索</div>  
                </div>
            </div>
            <!--header结束-->
        <div class="ub ub-ver ubt b-e7" id="ocontent">
            
        </div>
    </div>
    </body>
    <script src="js/newAppcan.js"></script>
    <script src="js/appcan.control.js"></script>
    <script src="js/common.js"></script>
    <script src="js/interface.js"></script>
    <script src="js/common.dom.js"></script>
    <script>
    var newslist="",
        keyValue="",
        pageNum=1,
        pageCount=1,
        columnId="",
        arrobjId = [],   //点击过的数组
        itemInfo={},
        icache,
        status=1,
        slideType=1;
    var childColumnInfo = appcan.locStorage.val('childColumnInfo');
    appcan.ready(function() {
        icache = appcan.icache({maxtask:5});
        childColumnInfo=JSON.parse(childColumnInfo);
        columnId=isDefine(childColumnInfo.childColumnId)?childColumnInfo.childColumnId:"";
        appcan.frame.setBounce([0, 1], null, null, function(type) {
            slideType=type;
            if (type == 0) {
                pageNum=1;
                getNewsItemData(1);
            }else{
                if ((pageNum - 1) * 10 > pageCount) {
                    appcan.frame.resetBounce(slideType);
                    ///uexWindow.toast("0", "5", "没有更多内容！", "1500");
                } else {
                    pageNum++;
                    getNewsItemData(pageNum);
                }
            }
        },bounceBgColor,imgSettingsVal)
        
        getNewsItemData(1);
   })
        
      //获取政务二级栏目下资讯列表的数据
    function getNewsItemData(pageNo,keyWord) {
        loader.open();
        status=0;
        var conditions="";
        var if_list="";
        if(isDefine(keyWord)){
            conditions={
                "keyWord":keyWord
            };
            if_list=getInterface('newsInfoGetList',columnId,pageNo,conditions);//接口封装配置函数
        }else{
            if_list=getInterface('newsInfoGetList',columnId,pageNo);//接口封装配置函数
        }
        //var if_list=getInterface('newsInfoGetList',columnId,pageNo,conditions);//接口封装配置函数
        console.log("newsItem====>"+JSON.stringify(if_list)+"\n"+chongqingUrl);
        appcan.request.ajax({
            url : chongqingUrl,
            headers : {
                token : appcan.locStorage.val("token") || '',
                deviceId : appcan.locStorage.val("deviceId") || ''
            },
            appVerify:true,
            data : JSON.stringify(if_list),
            timeout : "15000",
            type : "POST",
            contentType : "application/json",
            dataType : "json",
            success : function(res) {
                console.log(columnId+" >>>政务二级栏目下newsItem返回====>");
                console.log(res);
                appcan.frame.resetBounce(slideType);
                status=1;
                loader.close();
                
                if(res.status != '000'){
                    uexWindow.toast(1, 5, res.msg, 2000);
                    return false;
                }
                var datas=res.data; //后台获取数据
                pageCount = datas.totalNum;//新闻资讯列表总条数
                
                var conditions={
                    "isSummary":0,
                    "isComment":1,
                    "isPtime":1
                }
                
                if(pageNum==1){
                    //资讯列表首页显示
                    if(datas.list.length == 0){
                        $('#ocontent').html('<div class="ub ub-f1 ub-ac ub-pc c-66" style="margin-top:1em;">暂无信息</div>');
                        return false;
                    }else{
                         newsItem.domShow(1,0,datas.list,newsItemShow_goverment,conditions);//新闻列表显示
                    }
                }else{
                    //翻页资讯列表显示
                    if(datas.list.length>0){
                        newsItem.domShow(1,0,datas.list,newsItemShow_goverment,conditions);//新闻列表显示
                    }else{
                        status=1;
                    }
                }
            },
            error : function(xhr, errorType, error,msg) {
                console.log("error===>"+msg);
                status=1;
                appcan.frame.resetBounce(slideType);
                loader.close();
            }
        });
    }
    
    //callback显示政务列表数据
    function newsItemShow_goverment(newsItemDatas){
        var newsItemDom=isDefine(newsItemDatas.dom)?newsItemDatas.dom:"";
        itemInfo=$.extend(itemInfo,(isDefine(newsItemDatas.itemInfo) ? newsItemDatas.itemInfo:""));
        //alert(JSON.stringify(itemInfo));
        if(pageNum == 1){
            $("#ocontent").empty();
        }
        $('#ocontent').append(newsItemDom);
        
        // for(var j in itemImgList){//对象索引操作 调用图片预加载
            // preloadImg('img_'+itemImgList[j].imgId,itemImgList[j].imgUrl);
        // }
        
        //校验是否用户已点击过
        if(getLocVal('arrobjId1')){
            arrobjId = JSON.parse(getLocVal('arrobjId1'));
            for(var i = 0;i < arrobjId.length;i++){
                $("#"+arrobjId[i]).addClass('c-88');
            }
        }
        
        //列表点击处理
        appcan.button('.btnDetile','btn-act',function(e){
            var id=$(this);
            btn_ink(id,e);
            
            var newsIdVal = this.id;
            $(this.id).addClass('c-88');
            arrobjId.push(newsIdVal);
            setLocVal('arrobjId1',JSON.stringify(arrobjId));
            //传递点击列表信息
            appcan.locStorage.setVal('newsItemInfo',JSON.stringify(itemInfo[newsIdVal]));
            if(itemInfo[newsIdVal].newsTypeId==2){
                //跳转图片新闻展示页面
                appcan.window.open('home_DetailsPictures','home_DetailsPictures.html',10);
            }else if(itemInfo[newsIdVal].newsTypeId==5){
                //跳转专题列表
                appcan.window.open('spe_page','spe_page.html',10,1024);
            }else if(itemInfo[newsIdVal].newsTypeId==6){
                //跳转栏目
                var goColumnId=itemInfo[newsIdVal].columnId;
                //alert(goColumnId);
                uexWindow.evaluateScript("home_page", 0, "openFrame("+goColumnId+")");
                uexWindow.evaluateScript("", 0, "appcan.window.close();");
                uexWindow.evaluateScript("home_government", 0, "appcan.window.close();");
                
                // appcan.locStorage.setVal("govermentColumnDomIndex","id_"+goColumnId);
                // uexWindow.evaluateScript("", 0, "goGoverment("+goColumnId+")");
            }else{
                //跳转新闻详细页面
                appcan.window.open('home_Details','home_Details.html',10,1024);
            }
            
        })                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    }
    
    //搜索  
    appcan.button('#doSearch','btn-act',function(){
        search();
    })
    
    //搜索方法
    function search(){
       var keyWord=$("#keyVal").val();
       loader.open();
       getNewsItemData(1,keyWord);
    }
    
   
    
    //清空
    appcan.button('#clean','btn-act',function(){
        $("#keyVal").val('');
        keyValue = '';
    })
       
   function goTop(){
         window.scrollTo(0,0);
    }
        
    </script>
</html>
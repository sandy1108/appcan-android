<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="css/fonts/font-awesome.min.css">
        <link rel="stylesheet" href="css/ui-box.css">
        <link rel="stylesheet" href="css/ui-base.css">
        <link rel="stylesheet" href="css/ui-color.css">
        <link rel="stylesheet" href="css/appcan.icon.css">
        <link rel="stylesheet" href="css/appcan.control.css">
        <link rel="stylesheet" href="css/new_file.css">
        <link rel="stylesheet" href="css/common.css">
    </head>
    <body class="um-vp " ontouchstart>
        <div id="page_0" class="up ub ub-ver bc-bg" tabindex="0">
            <!--header开始-->
            <div id="header" class="bc-text-head ub ub-ver" style="background-color:#F3F3F3;">
                <div class="ub uinn" style="background-color: #F3F3F3;">
                    <div class="uinput ub ub-f1 uba ub-ac" style="background-color: #FFFFFF;border-radius:0.8em;margin-right:0.85em;">
                        <div class="ub ub-img ub-ac ub-pc" style="background-image: url('image/shous02.png'); width: 1.5em; height:1.3em;"></div>
                        <input placeholder="政府" id="keyVal" type="text" class="ub-f1">
                        <div class="ub-img ub-ac ub-pc ocancle" id="clean"></div> 
                    </div>
                    <div class="ub ub-ac ub-pc" id="doSearch" style="padding: .2em .5em;color: #fff;background-color:#FF8A00;border-radius:0.6em;">搜索</div>  
                </div>
            </div>
            <!--header结束-->
            <!--content开始-->
            <div id="content" class="ub-f1 tx-l">

            </div>
            <!--content结束-->
        </div>
    </body>
    
    <script src="js/newAppcan.js"></script>
    <script src="js/appcan.control.js"></script>
    <script src="js/common.js"></script>
    </body>
    <script>
        var pageNum = 1;
        var totalNum = 1;
        var status=0;//加载控制
        var hotLineClassName = appcan.locStorage.val('hotLineClassName');
        var slideType=1;
        appcan.ready(function() { 
            hotLineClassName=JSON.parse(hotLineClassName);
            appcan.frame.setBounce([0, 1], null, null, function(type) {
                slideType=type;
                if (type == 0) {
                    pageNum=1;
                    getInfo(1);
                }else{
                    if(status==1){
                        if ((pageNum - 1) * 10 > totalNum) {
                            appcan.frame.resetBounce(slideType);
                            //uexWindow.toast("0", "5", "没有更多内容！", "1500");
                        }else{
                            pageNum++;
                            getInfo(pageNum);
                        }
                    }
                }
            },bounceBgColor,imgSettingsVal)
            
            loader.open();
            getInfo(1);
        })
        //获取政务热线电话
        function getInfo(pageNo){
            status=0;
            var keyValue = $("#keyVal").val();
            var if_list =  {
                "transcode": "telephoneInfo_getList",
                "content": {
                    "className":hotLineClassName.className,
                    "keyWords":keyValue,
                    "page": {
                        "pageNo": pageNo,
                        "pageSize": 10
                    }
                }
            };
            console.log(JSON.stringify(if_list));
            appcan.request.ajax({
                url : chongqingUrl,
                headers : {
                    token : appcan.locStorage.val("token") || "",
                    deviceId : appcan.locStorage.val("deviceId") || ""
                },
                appVerify:true,
                data : JSON.stringify(if_list),
                type : "POST",
                //appVerify:true,
                //offline:true,
                timeout : "15000",
                contentType : "application/json",
                dataType : "json",
                success : function(res) {
                    console.log("政务热线电话数据返回=====>");
                    console.log(res);
                    uexWindow.closeToast();
                    appcan.frame.resetBounce(slideType);
                    loader.close();
                    if(res.status != '000'){
                        appcan.window.openToast(res.msg,2000);
                        return false;
                    }
                    totalNum = res.data.totalNum;
                    var list = res.data.list;
                    var temp = '';
                    if(list.length == 0 && pageNo==1){
                        $("#content").html('<div class="ub ub-f1 ub-ac ub-pc" style="margin-top:1em">暂无数据</div>');
                        return false;
                    }
                    for(var i = 0;i < list.length;i++){
                        temp += '<div class="ub ub-h">'
                                +'<div class="ub ub-f1 ub-pj ubb" onclick="phoneTel(\''+list[i].teleNumber+'\')" style="padding: 0.5em 0em 0.5em 1em; width: 100%; border-bottom-color: #CFCFCF;">'
                                    +'<div class="ub ub-f1" >'
                                        +'<div class="ub ub-ac ub-pc">'
                                            +list[i].teleName+"："+list[i].teleNumber
                                        +'</div>'
                                    +'</div>'
                                    +'<div class="nav-btn" id="nav-left">'
                                        +'<div class="fa fa-2x" style="color: #CFCFCF;"></div>'
                                    +'</div>'
                                +'</div>'
                            +'</div>';
                    }
                    if(pageNo == 1){
                        $("#content").empty();
                    }
                    $("#content").append(temp);
                    status=1;
                },
                error : function() {
                    status=1;
                    uexWindow.closeToast();
                    appcan.frame.resetBounce(slideType);
                }
            });
            
        }
        
        function phoneTel(tel){
             uexCall.dial(tel);         //打开拨号界面
        }
              
        //搜索电话方法
        appcan.button("#clean", "btn-act", function() {
              $("#keyVal").val('');
              keyValue = '';
        })
        appcan.button("#doSearch", "btn-act", function() {
             getInfo(1,1);
        })
         //双击回到顶部测试
        $("#header").on("doubleTap",function(){
            appcan.window.evaluatePopoverScript("","content","goTop()");
        })
    </script>
</html>
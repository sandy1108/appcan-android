<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="css/fonts/font-awesome.min.css">
        <link rel="stylesheet" href="css/ui-box.css">
        <link rel="stylesheet" href="css/ui-base.css">
        <link rel="stylesheet" href="css/ui-color.css">
        <link rel="stylesheet" href="css/appcan.icon.css">
        <link rel="stylesheet" href="css/appcan.control.css">
        <link rel="stylesheet" href="css/new_file.css">
        <link rel="stylesheet" href="css/loader.css">
    </head>
    <body class="um-vp oc_gray" ontouchstart>
        <div class="ub ub-ver">
            <div class="ub ub-ac ubb b-d2 oc_white uinn" style="margin-top:1em;min-height: 2em;">
                <div class=" uinput ub ub-f1  bc-border">
                    <input id="oldpwd" placeholder="旧密码" style="padding-left: .5em;" type="password" class="ub-f1">
                </div>
            </div>
            <div class="ub ub-ac ubb b-d2 oc_white uinn" style="min-height: 2em;">
                <div class=" uinput ub ub-f1  bc-border">
                    <input id="newpwd" placeholder="修改新密码" style="padding-left: .5em;" type="password" class="ub-f1">
                </div>
            </div>
            <div class="ub ub-ac ubb b-d2 oc_white uinn" style="min-height: 2em;">
                <div class=" uinput ub ub-f1  bc-border">
                    <input id="surepwd" placeholder="确认密码" style="padding-left: .5em;" type="password" class="ub-f1">
                </div>
            </div>
        </div>
    </body>
    <script src="js/appcan.js"></script>
    <script src="js/appcan.control.js"></script>
    <script src="js/common.js"></script>
    </body>
    <script>
    var userInfo=isDefine(getLocVal('userInfo')) ? getLocVal('userInfo'):"";
    var userId="";
    appcan.ready(function() {
        userId = isDefine(userInfo)?JSON.parse(userInfo).userId:"";
        appcan.initBounce();
    });

    function changePwd(){
        loader.open();
        var oldpwd =$("#oldpwd").val();
        //alert(oldpwd);
        var newpwd =$("#newpwd").val();
        var surepwd=$("#surepwd").val();
        //alert(newpwd);
        if(oldpwd==""||newpwd==""||surepwd==""){
            uexWindow.toast(0,5,"请输入完整信息",2000);
            loader.close();
            return;
        }
        if(newpwd.length<6||newpwd.length>14){
            uexWindow.toast(0,5,"请输入6~14位长度密码",2000);
            loader.close();
            return;
        }
        if(newpwd!=surepwd){
            uexWindow.toast(0,5,"两次输入的新密码不一致",2000);
            loader.close();
            return;
        } 
        var list={
                "transcode": "userInfo_modify",
                "info": "changePassword",
                "content": {
                    "userId": userId,
                    "newPwd": newpwd,
                    "originalPwd": oldpwd
                }
           };
          console.log(JSON.stringify(list));
          appcan.request.ajax({
            url:chongqingUrl,
            headers : {
                token : appcan.locStorage.val("token")||"",
                deviceId:appcan.locStorage.val("deviceId")||""
            },
            data : list,
            type : "POST",
            appVerify:true,
            timeout : "15000",
            dataType:"json",
            contentType : "application/json",
            success : function(res) {
                console.log("密码修改返回结果===>");
                console.log(res);
                loader.close();
                if(res.status=="000"){
                    uexWindow.toast(0,5,"修改成功",2000);
                    setTimeout('closeWindow()',2000);
                }else{
                    uexWindow.toast(0,5,"修改失败,请确认密码无误",2000);
                }
            },
            error : function(err) {
                loader.close();
            }
        });      
    }
    
    function closeWindow(){
        appcan.window.publish("closeChangepwd","");
    }
    </script>
</html>
